{% extends "layouts/PINS-post-mvp.html" %}

{% set title = "Redact LPA statement" %}
{% set pageName = title + ' - Planning Inspectorate'%}

{% set back = true %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-l">Appeal 2114328</span>
    <h1 class="govuk-heading-l">
      {{ title }}
    </h1>

    <p class="govuk-!-margin-bottom-0">Original statement:</p>
    {{ govukInsetText({
      classes: 'govuk-!-margin-top-2',
      text: "I am appealing the decision to refuse planning permission for the proposed rear extension at 14 Meadowbrook Close. The extension is modest in scale and has been designed to be in keeping with the character of the existing property and surrounding area."
    }) }}

    <p id="replaceHint">Replace any character with █ to redact it.</p>

    <form method="post" class="govuk-!-margin-top-2">

      {{ govukTextarea({
        name: "redactedComment",
        id: "redactedComment",
        rows: "9",
        label: {
          text: "Redacted statement",
          classes: "govuk-label--m",
          isPageHeading: false
        },

        value: "I am appealing the decision to refuse planning permission for the proposed rear extension at 14 Meadowbrook Close. The extension is modest in scale and has been designed to be in keeping with the character of the existing property and surrounding area."

      }) }}

      <div class="govuk-button-group app-hidden">
        <button type="button" class="govuk-button govuk-button--secondary" id="redactButton">Redact selected text</button>
        <button type="button" class="govuk-button govuk-button--secondary" id="undoButton">Undo all changes</button>
      </div>

      {{ govukButton({
        text: "Continue"
      }) }}

    </form>

  </div>
</div>

{% endblock %}

{% block pageScripts %}
  {{super()}}
  <script>
    function getSel() {
        // Obtain the object reference for the textarea
      var txtarea = document.getElementById("redactedComment");

      // Obtain the index of the first and last selected character
      var start = txtarea.selectionStart;
      var finish = txtarea.selectionEnd;

      // Obtain all text from the textarea
      var allText = txtarea.value;

      // Calculate the length of the selection and create a "█" for each character
      var redactedText = "█".repeat(finish - start);

      // Replace the selected text with the redacted version
      var newText = allText.substring(0, start) + redactedText + allText.substring(finish);

      // Update the textarea with the new text
      txtarea.value = newText;

      // Set the cursor to immediately after the redacted section
      txtarea.selectionStart = txtarea.selectionEnd = start + redactedText.length;

      // Return focus to the textarea
      txtarea.focus();
    }

    $('#replaceHint').addClass('app-hidden')
    $('.govuk-button-group').removeClass('app-hidden')
    $('#redactButton')
      .on('click', getSel)
    $('#undoButton').on('click', function(e) {
      $('#redactedComment')[0].value = $('#redactedComment')[0].defaultValue
    })

  </script>
{% endblock %}
