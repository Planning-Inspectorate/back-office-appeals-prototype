{% extends "layouts/bo.html" %}

{% set title = 'Check details and mark appeal as invalid' %}
{% set pageName = title %}

{% block beforeContent %}
  {{ govukBackLink({ text: "Back", href: 'javascript:history.back()' }) }}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">

    <span class="govuk-caption-l">Appeal {{ data['appealReference'] or '1223443' }}</span>
    <h1 class="govuk-heading-l">{{ title }}</h1>

    {# ---------------------------------------------- #}
    {# INVALID REASONS LIST #}
    {# ---------------------------------------------- #}

    {% set invalidReasonsHtml %}
      {% if data['invalid'] %}
        <ul class="govuk-list govuk-list--bullet">
          {% for reason in data['invalid'] %}
            <li>{{ reason }}</li>
          {% endfor %}
        </ul>
      {% else %}
        Appellant does not have a legal interest in the land
      {% endif %}
    {% endset %}

    {# Linked Appeals Answer #}
    {% set linkedAppeals = data['linkedAppeals'] %}
    {% set linkedAnswer = linkedAppeals or "Yes" %}

    {# ---------------------------------------------- #}
    {# BASE SUMMARY LIST #}
    {# ---------------------------------------------- #}

    {% set summaryRows = [
      {
        key: { text: "Review decision" },
        value: { text: "Invalid" },
        actions: { items: [{ href: "enforcement-appeal", text: "Change" }] }
      },
      {
        key: { text: "Is the enforcement notice invalid?" },
        value: { text: "No" },
        actions: { items: [{ href: "enf-notice-invalid", text: "Change" }] }
      },
      {
        key: { text: "Why is the appeal invalid?" },
        value: { html: invalidReasonsHtml },
        actions: { items: [{ href: "appeal-invalid-reason", text: "Change" }] }
      },
      {
        key: { text: "Does the appellant have any other linked enforcement appeals?" },
        value: { text: linkedAnswer },
        actions: {
          items: [
            { href: "linked-appeals-check", text: "Change", visuallyHiddenText: "linked appeals" }
          ]
        }
      }
    ] %}

    {{ govukSummaryList({ rows: summaryRows }) }}

    {# ---------------------------------------------- #}
    {# EMAIL PREVIEW — APPELLANT #}
    {# ---------------------------------------------- #}

    {% set emailAppellant %}
      <div class="app-email-preview">
        <div class="app-email-preview__subject">
          Subject: Appeal invalid: {{ data["appealReference"] or "1223443" }}
        </div>

        <div class="app-email-preview__body">

          <p class="govuk-body">We have reviewed the appeal and it is not valid.</p>

          <h2 class="govuk-heading-m">Appeal details</h2>

          <div class="govuk-inset-text">
            Appeal reference number: {{ data["appealReference"] or "1223443" }}<br>
            Address: 22b The Peach Trees, Peckham, SE15 9HA<br>
            Enforcement notice reference: LPA12345678
          </div>

          <h2 class="govuk-heading-m">Why the appeal is invalid</h2>

          <p class="govuk-body">{{ invalidReasonsHtml | safe }}</p>
          <h3 class="govuk-heading-s">Ground (a) barred</h3>

          <p class="govuk-body">We cannot consider ground (a) because the enforcement notice was issued either:</p>

          <ul class="govuk-list govuk-list--bullet">
            <li>
              with enough time for you to submit a retrospective planning application
            </li>
            <li>
              within 2 years from the date that the local planning authority stopped considering the planning application
            </li>
          </ul>

          <h2 class="govuk-heading-m">What happens next</h2>

          <p class="govuk-body">Your appeal is now closed</p>

          {% if linkedAppeals == "Yes" %}
            <p class="govuk-body">The enforcement notice will not take effect unless we dismiss or you withdraw your other appeal 3849485.</p>
          {% else %}
            <p class="govuk-body">The compliance period for the enforcement notice starts from 30 November 2025.</p>
          {% endif %}

          <h2 class="govuk-heading-m">Planning Inspectorate's role</h2>

          <p class="govuk-body">The Planning Inspectorate cannot change or revke the decision. You can <a href="#">challenge the decision in the High Court</a> if you think the Planning Inspectorate made a legal mistake.</p>

          <p class="govuk-body">Planning Inspectorate</p>

          <p>
            <a href="mailto:caseofficers@planninginspectorate.gov.uk">caseofficers@planninginspectorate.gov.uk</a>
          </p>

        </div>
      </div>
    {% endset %}

    {{ govukDetails({
      summaryText: "Preview email to appellant",
      html: emailAppellant
    }) }}

    {# ---------------------------------------------- #}
    {# EMAIL PREVIEW – LPA #}
    {# ---------------------------------------------- #}

    {% set emailLpa %}
      <div class="app-email-preview">
        <div class="app-email-preview__subject">
          Subject: Appeal invalid: {{ data["appealReference"] or "1223443" }}
        </div>

        <div class="app-email-preview__body">
          <p class="govuk-body">We have reviewed the appeal and it is not valid.</p>

          <h2 class="govuk-heading-m">Appeal details</h2>
          <div class="govuk-inset-text">
            Appeal reference number: {{ data["appealReference"] or "1223443" }}<br>
            Address: 22b The Peach Trees, Peckham, SE15 9HA<br>
            Enforcement notice reference: LPA12345678
          </div>

          <h2 class="govuk-heading-m">Why the appeal is invalid</h2>

          <p class="govuk-body">{{ invalidReasonsHtml | safe }}</p>

          <h2 class="govuk-heading-m">What happens next</h2>

          <p class="govuk-body">The appeal is now closed</p>

          {% if linkedAppeals == "Yes" %}
            <p class="govuk-body">The enforcement notice will not take effect unless we dismiss the other appeal 3849485 or the appellant withdraws it.</p>
          {% else %}
            <p class="govuk-body">The compliance period for the enforcement notice starts from 30 November 2025.</p>
          {% endif %}

          <h2 class="govuk-heading-m">Give feedback</h2>

              <p class="govuk-body">This is a new service. Help us improve it and <a href="https://forms.office.com/pages/responsepage.aspx?id=mN94WIhvq0iTIpmM5VcIjYt1ax_BPvtOqhVjfvzyJN5UOUlNRkhaQjNXTDQyNEhSRExNOFVGSkNJTS4u&route=shorturl">give your feedback (opens in new tab)</a>.</p>

          <p class="govuk-body">Planning Inspectorate</p>
          <p class="govuk-body"><a href="mailto:caseofficers@planninginspectorate.gov.uk">caseofficers@planninginspectorate.gov.uk</a></p>
        </div>
      </div>
    {% endset %}

    {{ govukDetails({
      summaryText: "Preview email to LPA",
      html: emailLpa
    }) }}

    <p class="govuk-body">
      We will mark the appeal as invalid and send an email to the relevant parties.
    </p>

    <form method="post">
      {{ govukButton({ text: "Mark appeal as invalid" }) }}
    </form>

  </div>
</div>
{% endblock %}

