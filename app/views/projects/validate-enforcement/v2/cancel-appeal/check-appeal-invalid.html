{% extends "layouts/bo.html" %}

{% set title = 'Check details and mark appeal as invalid' %}
{% set pageName = title %}

{% block beforeContent %}
  {{ govukBackLink({
    text: "Back",
    href: 'javascript:history.back()'
  }) }}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds-from-desktop">

    <span class="govuk-caption-l">Appeal 1223443</span>
    <h1 class="govuk-heading-l">{{ title }}</h1>

    {# ------------------------------------------------ #}
    {# SAFE INVALID REASONS BLOCK                      #}
    {# ------------------------------------------------ #}

    {% set invalid_list = data['invalid'] if data['invalid'] is iterable else [] %}

    {% set invalidReasonsHtml %}
      {% if invalid_list | length > 0 %}
        <ul class="govuk-list govuk-list--bullet">
          {% for reason in invalid_list %}
            <li>{{ reason }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <span>Appeal not submitted on time</span>
      {% endif %}
    {% endset %}

    {# Linked Appeals Answer #}
{% set linkedAppeals = data['linkedAppeals'] %}
{% set linkedAnswer = linkedAppeals or "No" %}

    {# ------------------------------------------------ #}
    {# SUMMARY LIST                                      #}
    {# ------------------------------------------------ #}

    {{ govukSummaryList({
      rows: [
        {
          key: { text: "Why are you cancelling the appeal?" },
          value: { text: data['cancel-reason'] or "Appeal invalid" },
          actions: {
            items: [
              {
                href: "cancel-reason",
                text: "Change",
                visuallyHiddenText: "Cancel reason"
              }
            ]
          }
        },
        {
          key: { text: "Why is the appeal invalid?" },
          value: { html: invalidReasonsHtml | safe },
          actions: {
            items: [
              {
                href: "appeal-invalid-reason",
                text: "Change",
                visuallyHiddenText: "invalid reason"
              }
            ]
          }
        },
        {
          key: { text: "Are there any other live appeals against the enforcement notice?" },
          value: { text: linkedAnswer },
          actions: {
            items: [
              { href: "linked-appeals-check", text: "Change", visuallyHiddenText: "linked appeals" }
            ]
          }
        }
      ]
    }) }}

    {# ------------------------------------------------ #}
    {# EMAIL PREVIEW – APPELLANT                        #}
    {# ------------------------------------------------ #}

    {% set emailToAppellant %}
    <div class="app-email-preview">
      <div class="app-email-preview__subject">
        Subject: Appeal cancelled: 1223443
      </div>
    
      <div class="app-email-preview__body">
        <h2 class="govuk-heading-m">Appeal details</h2>
    
        <div class="govuk-inset-text">
          Appeal reference number: 1223443<br>
          Address: 22b The Peach Trees, Peckham, SE15 9HA<br>
          Enforcement reference number: LPA12345678
        </div>
    
        <h2 class="govuk-heading-m">Your appeal is not valid</h2>
    
        <p class="govuk-body">We have reviewed your appeal and it is not valid.</p>
    
        <h2 class="govuk-heading-m">Why your appeal is not valid</h2>
    
        {{ invalidReasonsHtml | safe }}
    
        <h2 class="govuk-heading-m">What happens next</h2>
    
        <p class="govuk-body">
          Your appeal is now closed. We have told the local planning authority.
        </p>
    
        <p class="govuk-body">Planning Inspectorate</p>
      </div>
    </div>
    {% endset %}

    {{ govukDetails({
      summaryText: "Preview email to appellant",
      html: emailToAppellant
    }) }}
    

    {# ------------------------------------------------ #}
    {# EMAIL PREVIEW – LPA                              #}
    {# ------------------------------------------------ #}

    {% set emailToLPA %}
<div class="app-email-preview">
  <div class="app-email-preview__subject">
    Subject: Appeal cancelled: 1223443
  </div>

  <div class="app-email-preview__body">
    <h2 class="govuk-heading-m">Appeal details</h2>

    <div class="govuk-inset-text">
      Appeal reference number: 1223443<br>
      Address: 22b The Peach Trees, Peckham, SE15 9HA<br>
      Enforcement reference number: LPA12345678
    </div>

    <h2 class="govuk-heading-m">The appeal is not valid</h2>

    <p class="govuk-body">
      We have reviewed the appeal and it is not valid.
    </p>

    <p class="govuk-body">
      The appeal is now closed.
    </p>

    <h2 class="govuk-heading-m">Why the appeal is not valid</h2>

    {{ invalidReasonsHtml | safe }}

    <p class="govuk-body">Planning Inspectorate</p>
  </div>
</div>
{% endset %}


{{ govukDetails({
  summaryText: "Preview email to LPA",
  html: emailToLPA
}) }}

    <form method='post'>
      {{ govukButton({ text: 'Mark appeal as invalid' }) }}
    </form>

  </div>
</div>
{% endblock %}

