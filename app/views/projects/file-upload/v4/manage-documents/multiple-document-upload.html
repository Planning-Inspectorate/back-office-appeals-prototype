{% extends "layouts/PINS.html" %}

{% set pageName="Appellant Case" %}

{% block backLink %}
  {{ govukBackLink({
    text: "Back",
    href: "javascript:window.history.back()"
  }) }}
{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <span class="govuk-caption-l">Appeal 12345678</span>
    <h1 class="govuk-heading-l">Upload cross-team correspondence</h1>

    <p>
      Each file must be a PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, MSG, JPG, JPEG, MPEG, MP3, MP4, MOV, PNG, TIF or TIFF
      and smaller than 250MB.
    </p>

    <p>
      The total size of your uploaded files must be smaller than 1GB.
    </p>

    <h2 class="govuk-heading-m">Upload cross-team correspondence</h2>

    <form id="uploadForm">

      <div class="moj-multi-file-upload" data-module="moj-multi-file-upload">

        <!-- Dashed upload area -->
        <div
          class="moj-multi-file-upload__upload"
          style="border: 2px dashed #b1b4b6; padding: 60px 0 60px 16px; background-color: #ffffff; margin-bottom: 30px; display: flex;"
        >
          <div class="govuk-form-group" style="margin-bottom: 0; display: flex; align-items: center;">
            <label
              class="govuk-button govuk-button--secondary"
              for="documents"
              style="margin-bottom: 0; cursor: pointer;"
            >
              Choose files
            </label>

            <p class="govuk-body" style="margin: 0 0 0 10px;">or drop files</p>

            <input
              class="govuk-file-upload moj-multi-file-upload__input"
              id="documents"
              name="documents"
              type="file"
              multiple
              style="position: absolute; left: -9999px;"
            >
          </div>
        </div>

        <!-- Uploaded files list (not shown before redirect, but kept for completeness) -->
        <div class="govuk-summary-list moj-multi-file-upload__list"></div>

      </div>

      <!-- Continue button is now inert -->

      {{ govukButton({
        text: "Continue",
        href: "file-details-date-received"
      }) }}

    </form>

  </div>
</div>

<script>
let uploadedFiles = [];

document.addEventListener('DOMContentLoaded', function () {
  const fileInput = document.getElementById('documents');
  const uploadArea = document.querySelector('.moj-multi-file-upload__upload');

  if (!fileInput || !uploadArea) {
    console.error('Upload elements not found');
    return;
  }

  // When files are chosen, redirect immediately
  fileInput.addEventListener('change', function () {
    const files = fileInput.files;

    if (!files || files.length === 0) {
      return;
    }

    for (let i = 0; i < files.length; i++) {
      uploadedFiles.push({
        id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        name: files[i].name,
        size: files[i].size,
        file: files[i]
      });
    }

    fileInput.value = '';

    // ðŸ‘‰ Go straight to uploading screen
    window.location.href = 'file-uploading';
  });

  // Drag over styling
  uploadArea.addEventListener('dragover', function (e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#0b0c0c';
    uploadArea.style.backgroundColor = '#f8f8f8';
  });

  uploadArea.addEventListener('dragleave', function (e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#b1b4b6';
    uploadArea.style.backgroundColor = '#ffffff';
  });

  // Drop files â†’ redirect
  uploadArea.addEventListener('drop', function (e) {
    e.preventDefault();

    uploadArea.style.borderColor = '#b1b4b6';
    uploadArea.style.backgroundColor = '#ffffff';

    const files = e.dataTransfer.files;

    if (!files || files.length === 0) {
      return;
    }

    for (let i = 0; i < files.length; i++) {
      uploadedFiles.push({
        id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
        name: files[i].name,
        size: files[i].size,
        file: files[i]
      });
    }

    // ðŸ‘‰ Go straight to uploading screen
    window.location.href = 'file-uploading';
  });
});
</script>

{% endblock %}


