{% extends "layouts/bo.html" %}

{% set title = "Check details and set up site visit" %}
{% set pageName = title %}
{% set back = true %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <span class="govuk-caption-l">Appeal 6021709</span>
      <h1 class="govuk-heading-l">{{ title }}</h1>

      {# months lookup #}
      {% set months = [
        "", "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ] %}

      {# compute dateDisplay (or default) #}
      {% if data.setupVisit.visitDate
         and data.setupVisit.visitDate.day
         and data.setupVisit.visitDate.month
         and data.setupVisit.visitDate.year %}
        {% set dateDisplay = (
          data.setupVisit.visitDate.day
          ~ ' '
          ~ months[(data.setupVisit.visitDate.month | int)]
          ~ ' '
          ~ data.setupVisit.visitDate.year
        ) %}
      {% else %}
        {% set dateDisplay = '17 March 2026' %}
      {% endif %}

      {# compute start time display safely #}
      {% set startHour = data.setupVisit.startTime.hour or '' %}
      {% if data.setupVisit.startTime and data.setupVisit.startTime.minute %}
        {% set startMinutePart = ':' ~ data.setupVisit.startTime.minute %}
      {% else %}
        {% set startMinutePart = '' %}
      {% endif %}
      {% set startTimeDisplay = (startHour ~ startMinutePart) or '10:00' %}

      {# compute end time display safely #}
      {% set endHour = data.setupVisit.endTime.hour or '' %}
      {% if data.setupVisit.endTime and data.setupVisit.endTime.minute %}
        {% set endMinutePart = ':' ~ data.setupVisit.endTime.minute %}
      {% else %}
        {% set endMinutePart = '' %}
      {% endif %}
      {% set endTimeDisplay = (endHour ~ endMinutePart) or '11:00' %}

      {{ govukSummaryList({
        rows: [
          {
            key: { text: "Type" },
            value: { html: data.setupVisit.type or '—' },
            actions: { items: [{ href: "visit-type", text: "Change", visuallyHiddenText: "Type" }] }
          },
          {
            key: { text: "Do you know the date and time of the site visit?" },
            value: { html: data['date-check'] or '—' },
            actions: { items: [{ href: "date-and-time-check", text: "Change", visuallyHiddenText: "Do you know the date and time?" }] }
          },
          {
            key: { text: "Date" },
            value: { html: dateDisplay },
            actions: { items: [{ href: "date-and-time-check", text: "Change" }] }
          },
          {
            key: { text: "Start time" },
            value: { html: startTimeDisplay },
            actions: { items: [{ href: "date-and-time-check", text: "Change" }] }
          },
          {
            key: { text: "End time" },
            value: { html: endTimeDisplay },
            actions: { items: [{ href: "date-and-time-check", text: "Change" }] }
          }
        ]
      }) }}

      <p class="govuk-body">We’ll send an email to the appellant and LPA to tell them about the site visit.</p>

      <form method="post">
        {{ govukButton({ text: "Set up site visit" }) }}
      </form>
    </div>
  </div>
{% endblock %}

